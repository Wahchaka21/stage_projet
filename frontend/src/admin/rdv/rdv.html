<!-- Liste des RDV existants -->
<div class="rounded-2xl border border-[#e1e9f5] bg-white p-5 shadow max-w-2xl mb-5">
    <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold text-[#315f92]">Rendez-vous existants</h3>

        <button *ngIf="hasAny()" type="button" (click)="showCreate = !showCreate"
            class="rounded-full border border-[#315f92]/30 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-[#315f92] hover:bg-[#315f92]/10 cursor-pointer">
            {{ showCreate ? 'Fermer' : 'Ajouter un RDV ?' }}
        </button>
    </div>

    <p class="text-sm text-[#527bab]" *ngIf="listLoading">Chargement…</p>
    <p class="rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700" *ngIf="listError">{{ listError
        }}</p>
    <p class="text-sm text-[#527bab]" *ngIf="!listLoading && !listError && items.length === 0">
        Aucun RDV pour cet utilisateur.
    </p>

    <ul class="space-y-3" *ngIf="!listLoading && !listError && items.length > 0">
        <li *ngFor="let r of items" class="rounded-xl border border-[#e1e9f5] bg-[#f5f7fb] p-3">
            <div class="flex items-start justify-between gap-3">
                <div>
                    <div class="text-sm font-semibold text-[#315f92]">
                        {{ r.at | date:'fullDate' }} — {{ r.at | date:'shortTime' }}
                    </div>
                    <div class="text-sm text-[#527bab]" *ngIf="r.description">
                        {{ r.description }}
                    </div>
                </div>
                <button type="button" (click)="delete(r)"
                    class="rounded-full border border-red-300 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-red-600 hover:bg-red-50 cursor-pointer">
                    Supprimer
                </button>
            </div>
        </li>
    </ul>
</div>

<!-- Création d’un RDV -->
<div class="rounded-2xl border border-[#e1e9f5] bg-[#f5f7fb] p-5 shadow-inner max-w-2xl" *ngIf="showCreate">
    <h3 class="text-lg font-semibold text-[#315f92] mb-3">Planifier un rendez-vous</h3>

    <div class="grid gap-4 sm:grid-cols-2">
        <div class="sm:col-span-1">
            <label class="block text-sm font-medium text-[#315f92] mb-1">Date & heure</label>
            <input type="datetime-local" [(ngModel)]="rdvLocal" name="rdvLocal"
                class="w-full rounded-xl border border-[#315f92]/30 bg-white px-3 py-2 text-sm text-[#315f92] focus:border-[#315f92] focus:outline-none" />
        </div>

        <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-[#315f92] mb-1">Description (optionnelle)</label>
            <textarea rows="4" [(ngModel)]="rdvDescription" name="rdvDescription"
                class="w-full rounded-xl border border-[#315f92]/30 bg-white px-3 py-2 text-sm text-[#315f92] focus:border-[#315f92] focus:outline-none"
                placeholder="Ex: appel de suivi, séance, etc."></textarea>
        </div>

        <div class="sm:col-span-2 flex items-center justify-end gap-3">
            <button type="button" (click)="handleCreateRdv()" [disabled]="rdvLoading || !selectedUserId"
                class="rounded-full bg-[#315f92] px-5 py-2 text-sm font-semibold text-white transition hover:bg-[#24476e] disabled:opacity-60 disabled:cursor-not-allowed cursor-pointer">
                {{ getCreateButtonLabel() }}
            </button>
        </div>
    </div>

    <p *ngIf="rdvError" class="mt-3 rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
        {{ rdvError }}
    </p>
    <p *ngIf="rdvSucces"
        class="mt-3 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700">
        {{ rdvSucces }}
    </p>
</div>